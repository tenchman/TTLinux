diff -up openssl-0.9.8j/apps/progs.pl.diet openssl-0.9.8j/apps/progs.pl
--- openssl-0.9.8j/apps/progs.pl.diet	2008-04-04 01:03:41.000000000 +0200
+++ openssl-0.9.8j/apps/progs.pl	2009-03-12 08:44:26.000000000 +0100
@@ -1,4 +1,4 @@
-#!/usr/local/bin/perl
+#!/usr/bin/perl
 
 print "/* apps/progs.h */\n";
 print "/* automatically generated by progs.pl for openssl.c */\n\n";
@@ -41,6 +41,8 @@ foreach (@ARGV)
 		{ print "#ifndef OPENSSL_NO_EC\n${str}#endif\n";}
 	elsif ( ($_ =~ /^dh$/) || ($_ =~ /^gendh$/) || ($_ =~ /^dhparam$/))
 		{ print "#ifndef OPENSSL_NO_DH\n${str}#endif\n"; }
+	elsif ( ($_ =~ /^ocsp$/))
+		{ print "#ifndef OPENSSL_NO_OCSP\n${str}#endif\n"; }
 	elsif ( ($_ =~ /^pkcs12$/))
 		{ print "#if !defined(OPENSSL_NO_DES) && !defined(OPENSSL_NO_SHA1)\n${str}#endif\n"; }
 	elsif ( ($_ =~ /^cms$/))
diff -up openssl-0.9.8j/crypto/err/err_all.c.diet openssl-0.9.8j/crypto/err/err_all.c
--- openssl-0.9.8j/crypto/err/err_all.c.diet	2008-11-24 17:14:14.000000000 +0100
+++ openssl-0.9.8j/crypto/err/err_all.c	2009-03-12 08:45:42.000000000 +0100
@@ -92,7 +92,9 @@
 #include <openssl/engine.h>
 #endif
 #include <openssl/ui.h>
+#ifndef OPENSSL_NO_OCSP
 #include <openssl/ocsp.h>
+#endif
 #include <openssl/err.h>
 #ifdef OPENSSL_FIPS
 #include <openssl/fips.h>
@@ -146,7 +148,9 @@ void ERR_load_crypto_strings(void)
 #ifndef OPENSSL_NO_ENGINE
 	ERR_load_ENGINE_strings();
 #endif
+#ifndef OPENSSL_NO_OCSP
 	ERR_load_OCSP_strings();
+#endif
 	ERR_load_UI_strings();
 #ifdef OPENSSL_FIPS
 	ERR_load_FIPS_strings();
diff -up openssl-0.9.8j/crypto/x509v3/ext_dat.h.diet openssl-0.9.8j/crypto/x509v3/ext_dat.h
--- openssl-0.9.8j/crypto/x509v3/ext_dat.h.diet	2008-11-05 19:36:50.000000000 +0100
+++ openssl-0.9.8j/crypto/x509v3/ext_dat.h	2009-03-12 08:44:26.000000000 +0100
@@ -62,8 +62,10 @@ extern X509V3_EXT_METHOD v3_pkey_usage_p
 extern X509V3_EXT_METHOD v3_ns_ia5_list[], v3_alt[], v3_skey_id, v3_akey_id;
 extern X509V3_EXT_METHOD v3_crl_num, v3_crl_reason, v3_crl_invdate;
 extern X509V3_EXT_METHOD v3_delta_crl, v3_cpols, v3_crld;
+#ifndef OPENSSL_NO_OCSP
 extern X509V3_EXT_METHOD v3_ocsp_nonce, v3_ocsp_accresp, v3_ocsp_acutoff;
 extern X509V3_EXT_METHOD v3_ocsp_crlid, v3_ocsp_nocheck, v3_ocsp_serviceloc;
+#endif
 extern X509V3_EXT_METHOD v3_crl_hold, v3_pci;
 extern X509V3_EXT_METHOD v3_policy_mappings, v3_policy_constraints;
 extern X509V3_EXT_METHOD v3_name_constraints, v3_inhibit_anyp;
diff -up openssl-0.9.8j/ssl/t1_lib.c.noocsp2 openssl-0.9.8j/ssl/t1_lib.c
--- openssl-0.9.8j/ssl/t1_lib.c.noocsp2	2009-03-12 10:13:34.000000000 +0100
+++ openssl-0.9.8j/ssl/t1_lib.c	2009-03-12 10:17:29.000000000 +0100
@@ -60,7 +60,9 @@
 #include <openssl/objects.h>
 #include <openssl/evp.h>
 #include <openssl/hmac.h>
+#ifndef OPENSSL_NO_OCSP
 #include <openssl/ocsp.h>
+#endif
 #include "ssl_locl.h"
 
 const char tls1_version_str[]="TLSv1" OPENSSL_VERSION_PTEXT;
@@ -190,7 +192,7 @@ unsigned char *ssl_add_clienthello_tlsex
 			ret += ticklen;
 			}
 		}
-
+#ifndef OPENSSL_NO_OCSP
 	if (s->tlsext_status_type == TLSEXT_STATUSTYPE_ocsp)
 		{
 		int i;
@@ -238,7 +240,7 @@ unsigned char *ssl_add_clienthello_tlsex
 		if (extlen > 0)
 			i2d_X509_EXTENSIONS(s->tlsext_ocsp_exts, &ret);
 		}
-
+#endif
 	if ((extdatalen = ret-p-2)== 0) 
 		return p;
 
@@ -419,6 +421,7 @@ int ssl_parse_clienthello_tlsext(SSL *s,
 
 			s->tlsext_status_type = *data++;
 			size--;
+#ifndef OPENSSL_NO_OCSP
 			if (s->tlsext_status_type == TLSEXT_STATUSTYPE_ocsp)
 				{
 				const unsigned char *sdata;
@@ -505,6 +508,7 @@ int ssl_parse_clienthello_tlsext(SSL *s,
  			 	* so ignore it.
  			 	*/
 				else
+#endif
 					s->tlsext_status_type = -1;
 			}
 		/* session ticket processed earlier */
--- openssl-0.9.8j/ssl/ssl_lib.c.noocsp2	2009-05-10 20:45:41.000000000 +0200
+++ openssl-0.9.8j/ssl/ssl_lib.c	2009-05-10 20:47:21.000000000 +0200
@@ -511,6 +511,7 @@ void SSL_free(SSL *s)
 	if (s->ctx) SSL_CTX_free(s->ctx);
 #ifndef OPENSSL_NO_TLSEXT
 	if (s->initial_ctx) SSL_CTX_free(s->initial_ctx);
+#ifndef OPENSSL_NO_OCSP
 	if (s->tlsext_ocsp_exts)
 		sk_X509_EXTENSION_pop_free(s->tlsext_ocsp_exts,
 						X509_EXTENSION_free);
@@ -519,6 +520,7 @@ void SSL_free(SSL *s)
 	if (s->tlsext_ocsp_resp)
 		OPENSSL_free(s->tlsext_ocsp_resp);
 #endif
+#endif
 	if (s->client_CA != NULL)
 		sk_X509_NAME_pop_free(s->client_CA,X509_NAME_free);
 
